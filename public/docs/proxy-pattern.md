# **Proxy Pattern**üõ°Ô∏è | [api-proxy –∑ –∫–æ–¥–æ–º](../../src/patterns/api/api-proxy.ts)

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–±–ª–µ–º–∏ üìù

–Ü–Ω–æ–¥—ñ –ø–æ—Ç—Ä—ñ–±–µ–Ω –ø—Ä–æ–º—ñ–∂–Ω–∏–π —à–∞—Ä –º—ñ–∂ –∫–ª—ñ—î–Ω—Ç–æ–º —ñ —Ä–µ–∞–ª—å–Ω–æ—é —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—î—é API ‚Äî –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è,
–ª–æ–≥—É–≤–∞–Ω–Ω—è, –∫–æ–Ω—Ç—Ä–æ–ª—é –¥–æ—Å—Ç—É–ø—É —Ç–æ—â–æ, –∞–¥–∂–µ API-–∑–∞–ø–∏—Ç–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥–æ—Ä–æ–≥–∏–º–∏ –∑–∞ —á–∞—Å–æ–º —ñ
—Ä–µ—Å—É—Ä—Å–∞–º–∏. –ü—Ä—è–º–∏–π –≤–∏–∫–ª–∏–∫ –∞–¥–∞–ø—Ç–µ—Ä–∞ –≤ —Ç–∞–∫–æ–º—É –≤–∏–ø–∞–¥–∫—É –Ω–µ –≥–Ω—É—á–∫–∏–π, –∞–¥–∂–µ —É –¥–µ—è–∫–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö
—Ç—ñ —Å–∞–º—ñ –∑–∞–ø–∏—Ç–∏ –ø–æ–≤—Ç–æ—Ä—é—é—Ç—å—Å—è –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤. –¢–æ–º—É –Ω–µ–æ–±—Ö—ñ–¥–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∫–µ—à—É–≤–∞–Ω–Ω—è —Ç–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è
–∑–∞–ø–∏—Ç—ñ–≤, –Ω–µ –∑–º—ñ–Ω—é—é—á–∏ –æ—Å–Ω–æ–≤–Ω—É –ª–æ–≥—ñ–∫—É HTTP-–∫–ª—ñ—î–Ω—Ç–∞.

## –ü—Ä–∏—á–∏–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞—Ç–µ—Ä–Ω—É Proxy ü§î

Proxy –¥–æ–∑–≤–æ–ª—è—î –≤—Å—Ç–∞–≤–∏—Ç–∏ –æ–±'—î–∫—Ç-–∑–∞–º—ñ—Å–Ω–∏–∫ –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª—å–Ω–æ—é —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—î—é, —â–æ–± —Ä–æ–∑—à–∏—Ä–∏—Ç–∏ –∞–±–æ
–∑–º—ñ–Ω–∏—Ç–∏ —ó—ó –ø–æ–≤–µ–¥—ñ–Ω–∫—É, –Ω–µ –∑–º—ñ–Ω—é—é—á–∏ —Å–∞–º –∫–ª–∞—Å. –¶–µ –¥–æ–∑–≤–æ–ª—è—î:

- –î–æ–¥–∞—Ç–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è, –ª–æ–≥—É–≤–∞–Ω–Ω—è –∞–±–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –¥–æ HTTP-–∫–ª—ñ—î–Ω—Ç–∞ –±–µ–∑ –∑–º—ñ–Ω–∏ –π–æ–≥–æ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó.
- –ó–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∑–∞ –∑–∞–ø–∏—Ç–∞–º–∏ –Ω–∞ —Ä—ñ–≤–Ω—ñ –æ–±–≥–æ—Ä—Ç–∫–∏.

## –ü–µ—Ä–µ–≤–∞–≥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è ‚úÖ

- **–ö–µ—à—É–≤–∞–Ω–Ω—è**: –∑–Ω–∏–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ HTTP-–∑–∞–ø–∏—Ç—ñ–≤
- **–õ–æ–≥—É–≤–∞–Ω–Ω—è**: –ø—Ä–æ–∑–æ—Ä–∏–π –∑–∞–ø–∏—Å —É—Å—ñ—Ö –∑–∞–ø–∏—Ç—ñ–≤
- **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É**: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Ç–æ–º
- –ì–Ω—É—á–∫–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ –±–µ–∑ –∑–º—ñ–Ω–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞

## –ù–µ–¥–æ–ª—ñ–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è ‚ö†Ô∏è

- **–£—Å–∫–ª–∞–¥–Ω–µ–Ω–Ω—è**: —â–µ –æ–¥–∏–Ω —Ä—ñ–≤–µ–Ω—å –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—ó
- **–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è**: –ø–æ–º–∏–ª–∫–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤ Proxy, –∞ –Ω–µ –≤ –∞–¥–∞–ø—Ç–µ—Ä—ñ
- –ú–æ–∂–ª–∏–≤–∞ –¥—É–±–ª—é—é—á–∞ –ª–æ–≥—ñ–∫–∞ –∞–±–æ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å –ø—Ä–∏ –≤—ñ–¥–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—ñ

## –û–ø–∏—Å —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó üîß

`ApiProxy` —Ä–µ–∞–ª—ñ–∑—É—î —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `HttpClient` —ñ –º—ñ—Å—Ç–∏—Ç—å `ApiCache`. –ü—Ä–∏ –≤–∏–∫–ª–∏–∫—É `get` —Ñ–æ—Ä–º—É—î
–∫–ª—é—á, –ø–µ—Ä–µ–≤—ñ—Ä—è—î –∫–µ—à, –ª–æ–≥—É—î –∑–∞–ø–∏—Ç, —ñ –≤ —Ä–∞–∑—ñ –ø–æ—Ç—Ä–µ–±–∏ –ø–µ—Ä–µ–¥–∞—î –≤–∏–∫–ª–∏–∫ –¥–∞–ª—ñ –≤ –∞–¥–∞–ø—Ç–µ—Ä.

## –ö–æ–¥–æ–≤–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è üíª

```ts
class ApiProxy implements HttpClient {
  private target: HttpClient
  private cache = new ApiCache()

  constructor(target: HttpClient) {
    this.target = target
  }

  async get<T>(url: string, options?: RequestOptions): Promise<ApiResponse<T>> {
    const key = this.createCacheKey('GET', url, options)
    const cached = this.cache.get<T>(key)
    if (cached) return cached

    this.logApiCall('GET', url, options)
    try {
      const response = await this.target.get<T>(url, options)
      this.cache.set(key, response)
      return response
    } catch (error) {
      this.handleError(error, 'GET', url)
    }
  }
}
```

```ts
class ApiCache {
  private cache = new Map<
    string,
    { data: ApiResponse<unknown>; timestamp: number }
  >()
  private readonly DEFAULT_TTL = 1000 * 60 * 5

  set<T>(key: string, data: ApiResponse<T>, ttl = this.DEFAULT_TTL) {
    this.cache.set(key, { data, timestamp: Date.now() + ttl })
  }

  get<T>(key: string): ApiResponse<T> | null {
    const cached = this.cache.get(key)
    if (!cached || cached.timestamp < Date.now()) return null
    return cached.data as ApiResponse<T>
  }
}
```
